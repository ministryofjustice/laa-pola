# Migrations
Migrations are Python scripts, generated by Alembic, that contain instructions for what SQLAlchemy needs to do to
match the database schema to the models defined in `app/models`.

These migration scripts are found in `app/db/migrations/versions`.

## How to create new migration scripts
Whenever you update a model you need to create a migration to instruct the database what changes need to be made to the schema.
This can be auto generated for you by running the following:
```bash
alembic revision --autogenerate -m "[RevisionName]"
```
This will create a migration script in app/db/migrations/versions with a hex revision tag.

## How to upgrade the database
To upgrade the database to the latest migration run:
```bash
alembic upgrade head
```
To upgrade the database to a given migration run:
```bash
alembic upgrade [RevisionTag]
```
These commands will use the `POSTGRES` variables defined in `app/config`.
These values can be overwritten by setting the appropriate environment variables.

## How to downgrade the database
To revert the database to a previous migration state run:
```bash
alembic downgrade [RevisionTag]
```

## View the databases current migration state
To view the current revision tag of the database run:
```bash
alembic current
```
### How does the database know it's current migration state?
A table is created in the database called alembic_version; with one field named: 'version_num'.
This holds the current revision tag of the database.
